
apiVersion: projectcontour.io/v1
kind: HTTPProxy
metadata:
  name: {{ .Key }}
  namespace: {{ .Namespace }}
  labels: 
    commit: {{ .Commit | quote }}
spec:
  routes:
  {{- range $key, $value := .Routes }}
    - conditions:
      - prefix: {{ $value.Route.Prefix }}
    {{- if $value.Route.Headers }}
      {{- range $key, $value := $value.Route.Headers }}
      - header:
          name: {{ $value.Name }}
      {{- end }}
    {{- end }}
    {{- if $value.Route.Redirect }}
      requestRedirectPolicy:
        hostname: {{ $value.Route.Redirect }}
    {{- else }}
      services:
        - name: {{ $value.Key }}
          port: 8080
    {{- end }}
  {{- end }}